<!DOCTYPE html>
<head>
    <meta charset="UTF-8">

    <!-- Initialize the viewport -->
    <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

    <!-- Load the required dependencies: A-frame and AR.js -->
    <script src="https://aframe.io/releases/0.9.2/aframe.min.js"></script>
    <script src="https://raw.githack.com/jeromeetienne/AR.js/2.0.5/aframe/build/aframe-ar.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.0.1/dist/aframe-extras.min.js"></script>
    <link rel="stylesheet" href="/style.css">

    <!-- This is a hack because at the time of writing there are some distortions in the provided visuals until the  -->
    <!-- system receives a resize event. The resize event must be triggered when everything has been loaded and the  -->
    <!-- camera has been initialized. All the events I tried didn't work, so in the end I resorted using a 3 seconds -->
    <!-- time-out after the load event. When this problem will be fixed in the AR.js library, this hack won't be necessary -->
    <!-- anymore -->
    <script>
    window.onload = function(){
        setTimeout(function(){
            var resizeEvent = window.document.createEvent('UIEvents');
            resizeEvent.initUIEvent('resize', true, false, window, 0);
            window.dispatchEvent(resizeEvent);
        }, 3000);
    };

//     AFRAME.registerComponent("listener", {
//       init: function() {
//         this.target = document.querySelector('#target');
//         this.prevPosition = null;
//         this.prevRotation = null;
//       },
//       tick: function() {
//         if (this.el.object3D.visible) {
//           this.target.setAttribute('visible', 'true')
//           if(this.prevPosition) {
//             this.target.object3D.position.lerp(this.prevPosition, 0.1)
//             let rot = this.target.object3D.rotation.toVector3().lerp(this.prevRotation, 0.1)
//             this.target.object3D.rotation.setFromVector3(rot)
//           } else {
//             this.target.setAttribute('position', this.el.getAttribute('position'))
//             this.target.setAttribute('rotation', this.el.getAttribute('rotation'))
//           }
//           this.prevPosition = this.el.object3D.position
//           this.prevRotation = this.el.object3D.rotation

//         } else {
//           this.target.setAttribute('visible', 'false')
//           this.prevPosition = null;
//           this.prevRotation = null;
//         }
//       }
//    });
    </script>
</head>

<body style="margin: 0; overflow: hidden;">
    <!-- a-scene defines the scene that we are agoing to use. After arjs= there are various options that can be customized  -->
    <!-- depending on your needs. For now just stick with these ones -->
    <a-scene embedded arjs="sourceType: webcam; debugUIEnabled: false;" vr-mode-ui="enabled: false">
      <a-assets>
        <img id="backdrop" src="https://cdn.glitch.com/000175c2-8ffb-40ab-9249-ccbb57f55fd8%2Fbackdrop.png?v=1570816564201">
        <a-asset-item id="zombie" response-type="arraybuffer" src="https://cdn.glitch.com/000175c2-8ffb-40ab-9249-ccbb57f55fd8%2Fzombie.glb?v=1570493187994"></a-asset-item>
      </a-assets>


      <!-- Defines the marker that we are going to use. Notice that we are not providing the image file, but the  -->
      <!-- "compiled" .patt file that we got from the online tool. the marker MUST BE ACCESSIBLE VIA HTTPS -->
       <a-marker preset="hiro"> 
        <!-- Here we define the content to show on the marker when it gets detected: a unit cube that lies on the floor and that is red -->
        <a-entity
            gltf-model="#zombie"
            animation-mixer="clip:mixamo.com; timeScale:1; loop:pingpong; crossFadeDuration:0;"
            position="0 -0.725 3"
            rotation="-90 0 0"
            scale="3 3 3"
        >
        </a-entity>

        <a-plane
            position="0 1 0"
            rotation="-90 0 0"
            height="4"
            width="2"
            material="src:#backdrop; transparent:true;
            "
        ></a-plane>


<!--         <a-entity geometry="primitive:box; depth:0.01;height:5;width:0.01;" position="0 0.5 0.5" rotation="90 0 0"></a-entity>
         -->
      </a-marker>
<!--
      <a-entity id="target">
        <a-entity
            gltf-model="#zombie"
            animation-mixer="clip:mixamo.com; timeScale:1; loop:pingpong; crossFadeDuration:0;"
            position="0 0.725 3"
            rotation="-90 0 0"
            scale="3 3 3"
        >
        </a-entity>
        <a-plane
            position="0 0 0"
            rotation="-90 0 0"
            height="1"
            width="1"
            material="src:#marker;
            "
        ></a-plane>
      </a-entity>
 -->
        <!-- Define the camera of the scene -->
      <a-entity camera></a-entity>

    </a-scene>
</body>
